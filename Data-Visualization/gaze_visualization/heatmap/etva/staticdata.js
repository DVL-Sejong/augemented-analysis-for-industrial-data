 let loadData = 
 [[
 [410.989011, 306.3829787,  0],
[410.989011,  306.3829787,  0],
[413.1868132, 308.2066869,  0],
[413.1868132, 308.2066869,  0],
[413.1868132, 308.2066869,  0],
[413.1868132, 310.0303951,  0],
[413.1868132, 311.8541033,  0],
[413.1868132, 310.0303951,  0],
[413.1868132, 310.0303951,  0],
[413.1868132, 310.0303951,  0],
[410.989011,  310.0303951,  0],
[410.989011,  308.2066869,  0],
[410.989011,  308.2066869,  0],
[410.989011,  308.2066869,  0],
[408.7912088, 310.0303951,  0],
[408.7912088, 310.0303951,  0],
[408.7912088, 308.2066869,  0],
[408.7912088, 308.2066869,  0],
[408.7912088, 308.2066869,  0],
[408.7912088, 310.0303951,  0],
[408.7912088, 310.0303951,  0],
[410.989011,  310.0303951,  0],
[410.989011,  310.0303951,  0],
[410.989011,  310.0303951,  0],
[413.1868132, 311.8541033,  0],
[413.1868132, 311.8541033,  0],
[410.989011,  311.8541033,  0],
[413.1868132, 311.8541033,  0],
[413.1868132, 310.0303951,  0],
[410.989011,  310.0303951,  0],
[410.989011,  308.2066869,  0],
[410.989011,  308.2066869,  0],
[410.989011,  306.3829787,  0],
[410.989011,  306.3829787,  0],
[413.1868132, 306.3829787,  0],
[410.989011,  304.5592705,  0],
[410.989011,  304.5592705,  0],
[410.989011,  304.5592705,  0],
[413.1868132, 306.3829787,  0],
[413.1868132, 306.3829787,  0],
[413.1868132, 308.2066869,  0],
[410.989011,  308.2066869,  0],
[410.989011,  308.2066869,  0],
[410.989011,  310.0303951,  0],
[410.989011,  310.0303951,  0],
[410.989011,  311.8541033,  0],
[410.989011,  311.8541033,  0],
[410.989011,  311.8541033,  3],
[410.989011,  311.8541033,  1],
[410.989011,  311.8541033,  1],
[408.7912088, 311.8541033,  1],
[413.1868132, 313.6778116,  1],
[424.1758242, 313.6778116,  1],
[441.7582418, 311.8541033,  1],
[470.3296703, 310.0303951,  1],
[503.2967033, 306.3829787,  1],
[536.2637363, 304.5592705,  1],
[571.4285714, 300.9118541,  1],
[606.5934066, 297.2644377,  1],
[639.5604396, 291.7933131,  1],
[661.5384615, 288.1458967,  1],
[679.1208791, 286.3221884,  1],
[685.7142857, 284.4984802,  1],
[690.1098901, 284.4984802,  1],
[692.3076923, 284.4984802,  2],
[694.5054945, 284.4984802,  0],
[696.7032967, 284.4984802,  0],
[698.9010989, 286.3221884,  0],
[698.9010989, 284.4984802,  0],
[698.9010989, 282.674772, 0],
[698.9010989, 280.8510638,  0],
[698.9010989, 279.0273556,  0],
[698.9010989, 275.3799392,  0],
[698.9010989, 273.556231, 0],
[696.7032967, 271.7325228,  0],
[696.7032967, 271.7325228,  0],
[694.5054945, 271.7325228,  0],
[696.7032967, 273.556231, 0],
[696.7032967, 275.3799392,  0],
[696.7032967, 277.2036474,  0],
[696.7032967, 277.2036474,  0],
[696.7032967, 277.2036474,  0],
[694.5054945, 279.0273556,  0],
[696.7032967, 279.0273556,  0],
[696.7032967, 279.0273556,  0],
[696.7032967, 279.0273556,  0],
[696.7032967, 277.2036474,  0],
[696.7032967, 275.3799392,  0],
[696.7032967, 275.3799392,  0],
[696.7032967, 275.3799392,  0],
[701.0989011, 275.3799392,  0],
[709.8901099, 273.556231, 0],
[716.4835165, 269.9088146,  0],
[723.0769231, 266.2613982,  0],
[725.2747253, 264.43769,  0],
[729.6703297, 260.7902736,  0],
[731.8681319, 258.9665653,  0],
[738.4615385, 255.3191489,  0],
[738.4615385, 253.4954407,  0],
[736.2637363, 253.4954407,  0],
[734.0659341, 255.3191489,  0],
[734.0659341, 255.3191489,  0],
[736.2637363, 257.1428571,  0],
[738.4615385, 257.1428571,  0],
[740.6593407, 258.9665653,  0],
[742.8571429, 257.1428571,  0],
[742.8571429, 258.9665653,  0],
[742.8571429, 258.9665653,  0],
[742.8571429, 258.9665653,  0],
[742.8571429, 260.7902736,  0],
[742.8571429, 260.7902736,  0],
[740.6593407, 258.9665653,  0],
[740.6593407, 258.9665653,  0],
[740.6593407, 260.7902736,  0],
[740.6593407, 260.7902736,  3],
[740.6593407, 260.7902736,  1],
[742.8571429, 258.9665653,  1],
[747.2527473, 257.1428571,  1],
[753.8461538, 251.6717325,  1],
[756.043956,  244.3768997,  1],
[756.043956,  235.2583587,  1],
[756.043956,  229.787234, 1],
[756.043956,  224.3161094,  1],
[758.2417582, 218.8449848,  1],
[756.043956,  213.3738602,  2],
[756.043956,  211.550152, 0],
[753.8461538, 211.550152, 0],
[753.8461538, 211.550152, 0],
[756.043956,  213.3738602,  0],
[758.2417582, 213.3738602,  0],
[760.4395604, 213.3738602,  0],
[760.4395604, 213.3738602,  0],
[762.6373626, 215.1975684,  0],
[762.6373626, 215.1975684,  0],
[760.4395604, 217.0212766,  0],
[760.4395604, 220.668693, 0],
[762.6373626, 220.668693, 0],
[762.6373626, 222.4924012,  0],
[762.6373626, 222.4924012,  0],
[762.6373626, 222.4924012,  0],
[760.4395604, 220.668693, 0],
[760.4395604, 220.668693, 0],
[760.4395604, 220.668693, 0],
[758.2417582, 220.668693, 0]
]];

preProcessing(loadData);
preEventFeatures(loadData);

function preProcessing(_data){
	let _observerDuration = [];
	let _observerLength = [];
	let _observerDegree = [];

	for(var i=0; i<_data.length; i++){
		// dataset level
		let prevCoord = [0, 0];
		let prevClass = -1;
		let sum = [];
		let _observerDur = [];
		let _observerDeg = [];
		for(let j=0; j<_data[i].length; j++){
			// row level
			let curCoord = [+_data[i][j][0], +_data[i][j][1]];
			let curClass = +_data[i][j][2];
			if(j==0 && (isNaN(curCoord[0])||isNaN(curCoord[1]))){
				alert("The first coordinates have NaN value.");
				console.log(curCoord);
			}

			if(j==0){
				prevCoord = curCoord;
				prevClass = curClass;
				sum.push(curCoord);
				continue;
			}

			if(isNaN(curCoord[0])||isNaN(curCoord[1])){
				console.log(curCoord);
			}

			let _degree = 0;
			_degree = preDegree(prevCoord, curCoord);
			let _divDeg = {
				'degree': _degree,
				'prevClass': prevClass,
				'curClass': curClass
			};
			_observerDeg.push(_divDeg);

			if(prevClass != curClass){
				//function for making centroid coordinates
				let _centroidCoord = preDuration(sum);

				let _div = {
					'x': _centroidCoord[0],
					'y': _centroidCoord[1],
					'duration': sum.length,
					'clss': prevClass
				};
				_observerDur.push(_div);

				sum = [];
			}

			sum.push(curCoord);
			prevCoord = curCoord;
			prevClass = curClass;
		}
		_observerDuration.push(_observerDur);
		_observerDegree.push(_observerDeg);
	}
	console.log("_observerDuration:");
	console.log(_observerDuration);
	//console.log("_observerDegree:");
	//console.log(_observerDegree);
}

function preEventFeatures(_data){
	let eventFeatList = [];

	for(let i=0; i<_data.length; i++){
		// dataset level
		let _obClass = [];

		for(let j=0; j<_data[i].length; j++){
			// row level
			let _class = _data[i][j][2];
			_obClass.push(_class);
		}

		// remove duplicated class
		let _uniq = _obClass.slice()
			.sort(function(a, b){
				return a-b;
			})
			.reduce(function(a, b){
				if (a.slice(-1)[0] != b) 
					a.push(b);
				return a;
			}, []);

		eventFeatList.push(_obClass);
	}
	//console.log("eventFeatList");
	//console.log(eventFeatList);

	let _eList = [];
	for(let i=0; i<eventFeatList.length; i++){
		for(let j=0; j<eventFeatList[i].length; j++){
			let _cls = eventFeatList[i][j];
			_eList.push(_cls);
		}
	}
	let totalEventFeatList = _eList.slice()
		.sort(function(a, b){
			return a-b;
		})
		.reduce(function(a, b){
			if (a.slice(-1)[0] != b) 
				a.push(b);
			return a;
		}, []);
	//console.log("totalEventFeatList");
	//console.log(totalEventFeatList);

	return eventFeatList;
}

function preDuration(_coordis){
	let _centroid = [];
	if(_coordis.length > 3){
		_centroid = get_polygon_centroid(_coordis);
	}else{
		let _tsum = [0, 0];
		for(var k=0; k<_coordis.length; k++){
			_tsum[0] += _coordis[k][0];
			_tsum[1] += _coordis[k][1];
		}
		_tsum[0] /= _coordis.length;
		_tsum[1] /= _coordis.length;

		_centroid = _tsum;
	}
	return _centroid;
}

function preLength(){

}

function preDegree(_coord1, _coord2){
	let _cx = _coord1[0];
	let _cy = _coord1[1];
	let _ex = _coord2[0];
	let _ey = _coord2[1];

	let _dx = _ex-_cx;
	let _dy = _ey-_cy;
	let _theta = Math.atan2(_dy, _dx);
	_theta *= (180/Math.PI);

	return _theta;
}


function get_polygon_centroid(pts) {
	let first = pts[0], last = pts[pts.length-1];

	if (first.x != last.x || first.y != last.y) pts.push(first);
	let twicearea=0, x=0, y=0;
	let nPts = pts.length;
	let p1, p2, f;
	for (let i=0, j=nPts-1; i<nPts; j=i++) {
		p1 = pts[i]; p2 = pts[j];
		f = p1[0]*p2[1] - p2[0]*p1[1];
		twicearea += f;          
		x += ( p1[0] + p2[0] ) * f;
		y += ( p1[1] + p2[1] ) * f;
	}
   	f = twicearea * 3;
   return [x/f, y/f];
}

